<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The function tcor() implements (together with its helper function
calc_rho()) the nonparametric estimation of the time varying correlation
coefficient proposed by Choi &amp;amp; Shin (2021). The general idea is to compute a
(Pearson) correlation coefficient (\(r(x,y) = \frac{\hat{xy} - \hat{x}\times\hat{y}}{
\sqrt{\hat{x^2}-\hat{x}^2} \times \sqrt{\hat{y^2}-\hat{y}^2}}\)), but instead of
using the means required for such a computation, each component (i.e.,
\(x\), \(y\), \(x^2\), \(y^2\), \(x \times y\)) is smoothed and the
smoothed terms are considered in place the original means. The intensity of
the smoothing depends on a unique parameter: the bandwidth (h). If h = Inf, the method produces the original (i.e., time-invariant) correlation
value. The smaller the parameter h, the more variation in time is being
captured. The parameter h can be provided by the user; otherwise it is
automatically estimated by the internal helper functions select_h() and
calc_RMSE() (see Details)."><title>Compute time varying correlation coefficients — tcor • timevarcorr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute time varying correlation coefficients — tcor"><meta property="og:description" content="The function tcor() implements (together with its helper function
calc_rho()) the nonparametric estimation of the time varying correlation
coefficient proposed by Choi &amp;amp; Shin (2021). The general idea is to compute a
(Pearson) correlation coefficient (\(r(x,y) = \frac{\hat{xy} - \hat{x}\times\hat{y}}{
\sqrt{\hat{x^2}-\hat{x}^2} \times \sqrt{\hat{y^2}-\hat{y}^2}}\)), but instead of
using the means required for such a computation, each component (i.e.,
\(x\), \(y\), \(x^2\), \(y^2\), \(x \times y\)) is smoothed and the
smoothed terms are considered in place the original means. The intensity of
the smoothing depends on a unique parameter: the bandwidth (h). If h = Inf, the method produces the original (i.e., time-invariant) correlation
value. The smaller the parameter h, the more variation in time is being
captured. The parameter h can be provided by the user; otherwise it is
automatically estimated by the internal helper functions select_h() and
calc_RMSE() (see Details)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">timevarcorr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/courtiol/timevarcorr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Compute time varying correlation coefficients</h1>
      <small class="dont-index">Source: <a href="https://github.com/courtiol/timevarcorr/blob/HEAD/R/tcor.R" class="external-link"><code>R/tcor.R</code></a></small>
      <div class="d-none name"><code>tcor.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function <code>tcor()</code> implements (together with its helper function
<code>calc_rho()</code>) the nonparametric estimation of the time varying correlation
coefficient proposed by Choi &amp; Shin (2021). The general idea is to compute a
(Pearson) correlation coefficient (\(r(x,y) = \frac{\hat{xy} - \hat{x}\times\hat{y}}{
\sqrt{\hat{x^2}-\hat{x}^2} \times \sqrt{\hat{y^2}-\hat{y}^2}}\)), but instead of
using the means required for such a computation, each component (i.e.,
\(x\), \(y\), \(x^2\), \(y^2\), \(x \times y\)) is smoothed and the
smoothed terms are considered in place the original means. The intensity of
the smoothing depends on a unique parameter: the bandwidth (<code>h</code>). If <code>h = Inf</code>, the method produces the original (i.e., time-invariant) correlation
value. The smaller the parameter <code>h</code>, the more variation in time is being
captured. The parameter <code>h</code> can be provided by the user; otherwise it is
automatically estimated by the internal helper functions <code>select_h()</code> and
<code>calc_RMSE()</code> (see <strong>Details</strong>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tcor</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  h <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"spearman"</span><span class="op">)</span>,</span>
<span>  kernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"box"</span>, <span class="st">"normal"</span><span class="op">)</span>,</span>
<span>  CI <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  CI.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  param_smoother <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  keep.missing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">calc_rho</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  t.for.pred <span class="op">=</span> <span class="va">t</span>,</span>
<span>  <span class="va">h</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"spearman"</span><span class="op">)</span>,</span>
<span>  kernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"box"</span>, <span class="st">"normal"</span><span class="op">)</span>,</span>
<span>  param_smoother <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">calc_RMSE</span><span class="op">(</span></span>
<span>  <span class="va">h</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"spearman"</span><span class="op">)</span>,</span>
<span>  kernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"box"</span>, <span class="st">"normal"</span><span class="op">)</span>,</span>
<span>  param_smoother <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">select_h</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"spearman"</span><span class="op">)</span>,</span>
<span>  kernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"box"</span>, <span class="st">"normal"</span><span class="op">)</span>,</span>
<span>  param_smoother <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>a numeric vector.</p></dd>


<dt>y</dt>
<dd><p>a numeric vector of to be correlated with <code>x</code>.</p></dd>


<dt>t</dt>
<dd><p>a (numeric or Date) vector of time points. If missing, observations
are considered to correspond to sequential time steps (i.e., 1, 2 ...).</p></dd>


<dt>h</dt>
<dd><p>a scalar indicating the bandwidth used by the smoothing function.</p></dd>


<dt>cor.method</dt>
<dd><p>a character string indicating which correlation coefficient
is to be computed ("pearson", the default; or "spearman").</p></dd>


<dt>kernel</dt>
<dd><p>a character string indicating which kernel to use: "epanechnikov"
(the default), "box", or "normal" (abbreviations also work).</p></dd>


<dt>CI</dt>
<dd><p>a logical specifying if a confidence interval should be computed or not (default = <code>FALSE</code>).</p></dd>


<dt>CI.level</dt>
<dd><p>a scalar defining the level for <code>CI</code> (default = 0.95 for 95% CI).</p></dd>


<dt>param_smoother</dt>
<dd><p>a list of additional parameters to provide to the
internal smoothing function (see <strong>Details</strong>).</p></dd>


<dt>keep.missing</dt>
<dd><p>a logical specifying if time points associated with missing
information should be kept in the output (default = <code>FALSE</code> to facilitate plotting).</p></dd>


<dt>verbose</dt>
<dd><p>a logical specifying if information should be displayed to
monitor the progress of the cross validation (default = <code>FALSE</code>).</p></dd>


<dt>t.for.pred</dt>
<dd><p>a (numeric or Date) vector of time points at which to
evaluate the smoothed fit. If missing, <code>t</code> is used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><strong>---Output for <code>tcor()</code>---</strong></p>



<p>A 2 x \(t\) dataframe containing:</p><ul><li><p>the time points (<code>t</code>).</p></li>
<li><p>the estimates of the correlation value (<code>r</code>).</p></li>
</ul><p>Or, if <code>CI = TRUE</code>, a 5 x \(t\) dataframe containing:</p><ul><li><p>the time points (<code>t</code>).</p></li>
<li><p>the estimates of the correlation value (<code>r</code>).</p></li>
<li><p>the Standard Error (<code>SE</code>).</p></li>
<li><p>the lower boundary of the confidence intervals (<code>lwr</code>).</p></li>
<li><p>the upper boundary of the confidence intervals (<code>upr</code>).</p></li>
</ul><p>Some metadata are also attached to the dataframe (as attributes):</p><ul><li><p>the call to the function (<code>call</code>).</p></li>
<li><p>the argument <code>CI</code>.</p></li>
<li><p>the bandwidth parameter (<code>h</code>).</p></li>
<li><p>the method used to select <code>h</code> (<code>h_selection</code>).</p></li>
<li><p>the minimal root mean square error when <code>h</code> is selected (<code>RMSE</code>).</p></li>
<li><p>the computing time (in seconds) spent to select the bandwidth parameter (<code>h_selection_duration</code>) if <code>h</code> automatically selected.</p></li>
</ul><p><strong>---Output for <code>calc_rho()</code>---</strong></p>



<p>A 14 x \(t\) dataframe with:</p><ul><li><p>the six raw components of correlation (<code>x</code>, <code>y</code>, <code>x2</code>, <code>y2</code>, <code>xy</code>).</p></li>
<li><p>the time points (<code>t</code>).</p></li>
<li><p>the six raw components of correlation after smoothing (<code>x_smoothed</code>, <code>y_smoothed</code>, <code>x2_smoothed</code>, <code>y2_smoothed</code>, <code>xy_smoothed</code>).</p></li>
<li><p>the standard deviation around \(x\) and \(y\) (<code>sd_x_smoothed</code>, <code>sd_y_smoothed</code>).</p></li>
<li><p>the smoothed correlation coefficient (<code>rho_smoothed</code>).</p></li>
</ul><p><strong>---Output for <code>calc_RMSE()</code>---</strong></p>



<p>A scalar of class numeric corresponding to the RMSE.</p>


<p><strong>---Output for <code>select_h()</code>---</strong></p>



<p>A list with the following components:</p><ul><li><p>the selected bandwidth parameter (<code>h</code>).</p></li>
<li><p>the method used to select <code>h</code> (<code>h_selection</code>).</p></li>
<li><p>the minimal root mean square error when <code>h</code> is selected (<code>RMSE</code>).</p></li>
<li><p>the computing time (in seconds) spent to select the bandwidth parameter (<code>time</code>).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    
<ul><li><p><strong>Smoothing</strong>: the smoothing of each component is performed by kernel
regression. The default is to use the Epanechnikov kernel following Choi &amp;
Shin (2021), but other kernels have also been implemented and can thus
alternatively be used (see <code><a href="kern_smooth.html">kern_smooth()</a></code> for details). The normal kernel
seems to sometimes lead to very small bandwidth being selected, but the
default kernel can lead to numerical issues (see next point). We thus
recommend always comparing the results from different kernel methods.</p></li>
<li><p><strong>Numerical issues</strong>: some numerical issues can happen because the smoothing
is performed independently on each component of the correlation coefficient.
As a consequence, some relationship between components may become violated
for some time points. For instance, if the square of the smoothed \(x\) term
gets larger than the smoothed \(x^2\) term, the variance of \(x\) would become
negative. In such cases, coefficient values returned are <code>NA</code>.</p></li>
<li><p><strong>Bandwidth selection</strong>: when the value used to define the bandwidth (<code>h</code>)
in <code>tcor()</code> is set to <code>NULL</code> (the default), the internal function <code>select_h()</code>
is used to to select the optimal value for <code>h</code>. It is first estimated by
leave-one-out cross validation (using internally <code>calc_RMSE()</code>). If the cross
validation error (RMSE) is minimal for the maximal value of <code>h</code> considered
(\(8\sqrt{N}\)), rather than taking this as the optimal <code>h</code> value, the
bandwidth becomes estimated using the so-called elbow criterion. This latter
method identifies the value <code>h</code> after which the cross validation error
decreasing very little. The procedure is detailed in section 2.1 in Choi &amp;
Shin (2021).</p></li>
<li><p><strong>Parallel computation</strong>: if <code>h</code> is not provided, an automatic bandwidth
selection occurs (see above). For large datasets, this step can be
computationally demanding. The current implementation thus relies on
<code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply()</a></code> and is thus only effective for Linux and MacOS.
Relying on parallel processing also implies that you call <code>options("mc.cores" = XX)</code> beforehand, replacing <code>XX</code> by the relevant number of CPU cores you
want to use (see <strong>Examples</strong>). For debugging, do use <code>options("mc.cores" = 1)</code>, otherwise you may not be able to see the error messages generated in
child nodes.</p></li>
<li><p><strong>Confidence interval</strong>: if <code>CI</code> is set to <code>TRUE</code>, a confidence interval is
calculated as described in Choi &amp; Shin (2021). This is also necessary for using
<code><a href="test_equality.html">test_equality()</a></code> to test differences between correlations at two time points.
The computation of the confidence intervals involves multiple internal
functions (see <code><a href="CI.html">CI</a></code> for details).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>tcor()</code>: <strong>the user-level function to be used</strong>.</p></li>
<li><p><code>calc_rho()</code>: computes the correlation for a given bandwidth.</p>
<p>The function calls the kernel smoothing procedure on each component required
to compute the time-varying correlation.</p></li>
<li><p><code>calc_RMSE()</code>: Internal function computing the root mean square error (RMSE) for a given bandwidth.</p>
<p>The function removes each time point one by one and predicts the correlation
at the missing time point based on the other time points. It then computes
and returns the RMSE between this predicted correlation and the one predicted
using the full dataset. See also <em>Bandwidth selection</em> and <em>Parallel
computation</em> in <strong>Details</strong>.</p></li>
<li><p><code>select_h()</code>: Internal function selecting the optimal bandwidth parameter <code>h</code>.</p>
<p>The function selects and returns the optimal bandwidth parameter <code>h</code> using an
optimizer (<code><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">stats::optimize()</a></code>) which searches the <code>h</code> value associated with
the smallest RMSE returned by <code>calc_RMSE()</code>. See also <em>Bandwidth selection</em>
in <strong>Details</strong>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Choi, JE., Shin, D.W. Nonparametric estimation of time varying correlation coefficient.
J. Korean Stat. Soc. 50, 333–353 (2021). <a href="https://doi.org/10.1007/s42952-020-00073-6" class="external-link">doi:10.1007/s42952-020-00073-6</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="test_equality.html">test_equality</a></code>, <code><a href="kern_smooth.html">kern_smooth</a></code>, <code><a href="CI.html">CI</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#####################################################</span></span></span>
<span class="r-in"><span><span class="co">## Examples for the user-level function to be used ##</span></span></span>
<span class="r-in"><span><span class="co">#####################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Effect of the bandwidth</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_h50</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_h100</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_h200</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_h50</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"Cor"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, las <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_h100</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_h200</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottom"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"50"</span>, <span class="st">"100"</span>, <span class="st">"200"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>, title <span class="op">=</span> <span class="st">"Bandwidth (h)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tcor-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Effect of the correlation method</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_pearson</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_spearman</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">150</span>,</span></span>
<span class="r-in"><span>                                      cor.method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_pearson</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"Cor"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_spearman</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottom"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"spearman"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>, title <span class="op">=</span> <span class="st">"cor.method"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tcor-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Infinite bandwidth should match fixed correlation coefficients</span></span></span>
<span class="r-in"><span><span class="co">## nb: `h = Inf` is not supported by default kernel (`kernel = 'epanechnikov'`)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_pearson_hInf</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="cn">Inf</span>,</span></span>
<span class="r-in"><span>                                           kernel <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_spearman_hInf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="cn">Inf</span>,</span></span>
<span class="r-in"><span>                                           kernel <span class="op">=</span> <span class="st">"normal"</span>, cor.method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">$</span><span class="va">SP500</span>, <span class="va">stockprice</span><span class="op">$</span><span class="va">FTSE100</span>, use <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">$</span><span class="va">SP500</span>, <span class="va">stockprice</span><span class="op">$</span><span class="va">FTSE100</span>, method <span class="op">=</span> <span class="st">"spearman"</span>, use <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">res_pearson_hInf</span><span class="op">$</span><span class="va">r</span><span class="op">)</span> <span class="op">-</span> <span class="va">r</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co">## 0 indicates near equality</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">res_spearman_hInf</span><span class="op">$</span><span class="va">r</span><span class="op">)</span> <span class="op">-</span> <span class="va">rho</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co">## 0 indicates near equality</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Computing and plotting the confidence interval</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_withCI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span>, <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">200</span>, CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">res_withCI</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span> <span class="op">~</span> <span class="va">t</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"Cor"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, las <span class="op">=</span> <span class="fl">1</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">lwr</span> <span class="op">~</span> <span class="va">t</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">upr</span> <span class="op">~</span> <span class="va">t</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tcor-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Same using tidyverse packages (dplyr and ggplot2 must be installed)</span></span></span>
<span class="r-in"><span><span class="co">## see https://github.com/courtiol/timevarcorr for more examples of this kind</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">stockprice</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span><span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>,</span></span>
<span class="r-in"><span>                 h <span class="op">=</span> <span class="fl">200</span>, CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">res_tidy</span></span></span>
<span class="r-in"><span>  <span class="va">res_tidy</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: dplyr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 4,326 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    t              r     SE   lwr   upr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2000-04-03 0.453 0.082<span style="text-decoration: underline;">3</span> 0.292 0.615</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2000-04-04 0.453 0.082<span style="text-decoration: underline;">1</span> 0.292 0.614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2000-04-05 0.453 0.081<span style="text-decoration: underline;">9</span> 0.293 0.614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2000-04-06 0.453 0.081<span style="text-decoration: underline;">7</span> 0.293 0.613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2000-04-07 0.453 0.081<span style="text-decoration: underline;">5</span> 0.294 0.613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2000-04-10 0.453 0.081<span style="text-decoration: underline;">3</span> 0.294 0.612</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2000-04-11 0.453 0.081<span style="text-decoration: underline;">1</span> 0.294 0.612</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2000-04-12 0.452 0.080<span style="text-decoration: underline;">9</span> 0.294 0.611</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2000-04-13 0.452 0.080<span style="text-decoration: underline;">7</span> 0.294 0.610</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2000-04-14 0.452 0.080<span style="text-decoration: underline;">5</span> 0.294 0.610</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 4,316 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">res_tidy</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">r</span>, ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SP500 vs FTSE100"</span>, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Correlation"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: ggplot2</span>
<span class="r-plt img"><img src="tcor-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Automatic selection of the bandwidth using parallel processing and comparison</span></span></span>
<span class="r-in"><span><span class="co">## of the 3 alternative kernels on the first 500 time points of the dataset</span></span></span>
<span class="r-in"><span><span class="co"># nb: takes a few seconds to run, so not run by default</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="in_pkgdown.html">in_pkgdown</a></span><span class="op">(</span><span class="op">)</span> <span class="op">||</span> <span class="cn">FALSE</span> <span class="co">## change to TRUE to run the example</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"mc.cores"</span> <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span> <span class="co">## CPU cores to be used for parallel processing</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_hauto_epanech</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>         <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, kernel <span class="op">=</span> <span class="st">"epanechnikov"</span><span class="op">)</span></span></span>
<span class="r-in"><span>         <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_hauto_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>          <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, kernel <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_hauto_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>          <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, kernel <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_hauto_epanech</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Cor"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, las <span class="op">=</span> <span class="fl">1</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_hauto_box</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_hauto_norm</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"grey"</span>, <span class="st">"orange"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"box"</span>, <span class="st">"normal"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>,</span></span>
<span class="r-in"><span>       title <span class="op">=</span> <span class="st">"Kernel"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 57.3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 5.9 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 75.6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 8.8 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 60.9</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 8.7 seconds</span>
<span class="r-plt img"><img src="tcor-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Comparison of the 3 alternative kernels under same bandwidth</span></span></span>
<span class="r-in"><span><span class="co">## nb: it requires to have run the previous example</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_epanech</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>          <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>,</span></span>
<span class="r-in"><span>          kernel <span class="op">=</span> <span class="st">"epanechnikov"</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_hauto_epanech</span>, <span class="st">"h"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>           <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>,</span></span>
<span class="r-in"><span>           kernel <span class="op">=</span> <span class="st">"box"</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_hauto_epanech</span>, <span class="st">"h"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>           <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>          <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>,</span></span>
<span class="r-in"><span>          kernel <span class="op">=</span> <span class="st">"norm"</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_hauto_epanech</span>, <span class="st">"h"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_epanech</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>, ylab <span class="op">=</span> <span class="st">"Cor"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>,</span></span>
<span class="r-in"><span>     las <span class="op">=</span> <span class="fl">1</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_box</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_norm</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"grey"</span>, <span class="st">"orange"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"box"</span>, <span class="st">"normal"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>,</span></span>
<span class="r-in"><span>       title <span class="op">=</span> <span class="st">"Kernel"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="tcor-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Automatic selection of the bandwidth using parallel processing with CI</span></span></span>
<span class="r-in"><span><span class="co"># nb: takes a few seconds to run, so not run by default</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="in_pkgdown.html">in_pkgdown</a></span><span class="op">(</span><span class="op">)</span> <span class="op">||</span> <span class="cn">FALSE</span> <span class="co">## change to TRUE to run the example</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res_hauto_epanechCI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>          <span class="fu">tcor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_hauto_epanechCI</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Cor"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, las <span class="op">=</span> <span class="fl">1</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_hauto_epanechCI</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"lwr"</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">res_hauto_epanechCI</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"upr"</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 57.3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 6 seconds</span>
<span class="r-plt img"><img src="tcor-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Not all kernels work well in all situations</span></span></span>
<span class="r-in"><span><span class="co">## Here the default kernell estimation leads to issues for last time points</span></span></span>
<span class="r-in"><span><span class="co">## nb1: EuStockMarkets is a time-series object provided with R</span></span></span>
<span class="r-in"><span><span class="co">## nb2: takes a few minutes to run, so not run by default</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="in_pkgdown.html">in_pkgdown</a></span><span class="op">(</span><span class="op">)</span> <span class="op">||</span> <span class="cn">FALSE</span> <span class="co">## change to TRUE to run the example</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">EuStock_epanech</span> <span class="op">&lt;-</span> <span class="fu">tcor</span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="st">"DAX"</span><span class="op">]</span>, <span class="va">EuStockMarkets</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="st">"SMI"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">EuStock_norm</span> <span class="op">&lt;-</span> <span class="fu">tcor</span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="st">"DAX"</span><span class="op">]</span>, <span class="va">EuStockMarkets</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="st">"SMI"</span><span class="op">]</span>, kernel <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">EuStock_epanech</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>, las <span class="op">=</span> <span class="fl">1</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">EuStock_norm</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"orange"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottom"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"epanechnikov"</span>, <span class="st">"normal"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>,</span></span>
<span class="r-in"><span>       title <span class="op">=</span> <span class="st">"Kernel"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 71.7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 4.5 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Numerical issues occured when computing the correlation values for the bandwidth value h = 71.7 resulting in `NA`(s) (see Details on *Numerical issues* in `?tcor`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  You may want to:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - try another bandwidth value using the argument `h`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - try another kernel using the argument `kernel`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - adjust the smoothing parameters using the argument `param_smoother` (see `?kern_smooth`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  This may not be an issue, if you are estimating `h` automatically, as issues may occur only for sub-optimal bandwidth values.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>1 out of 500 correlation values were estimated out of the [-1, 1] range and where thus forced to [-1, 1]. Using another kernel may avoid such problem.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 178.3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using elbow criterion = 54</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 17.9 seconds</span>
<span class="r-plt img"><img src="tcor-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##################################################################</span></span></span>
<span class="r-in"><span><span class="co">## Examples for the internal function computing the correlation ##</span></span></span>
<span class="r-in"><span><span class="co">##################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Computing the correlation and its component for the first six time points</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">)</span>, <span class="fu">calc_rho</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              x            y           x2           y2            xy          t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.004361280 -0.010096362 1.902076e-05 1.019365e-04 -4.403306e-05 2000-04-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -0.007980069 -0.003332639 6.368150e-05 1.110648e-05  2.659469e-05 2000-04-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -0.004479051 -0.007449493 2.006189e-05 5.549494e-05  3.336666e-05 2000-04-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.008375645  0.011874107 7.015143e-05 1.409944e-04  9.945331e-05 2000-04-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.009697455  0.015107515 9.404064e-05 2.282370e-04  1.465045e-04 2000-04-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -0.007420214 -0.004377977 5.505958e-05 1.916668e-05  3.248553e-05 2000-04-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      x_smoothed    y_smoothed  x2_smoothed  y2_smoothed  xy_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.0013418481 -0.0039462414 3.798239e-05 8.905361e-05 1.271878e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  0.0010704776 -0.0023441914 4.372446e-05 9.103955e-05 2.628156e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  0.0007590436 -0.0008249469 4.930863e-05 9.252018e-05 3.927963e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.0004106755  0.0006175389 5.474643e-05 9.353427e-05 5.175352e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.0000271654  0.0019865563 6.004416e-05 9.410375e-05 6.372498e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -0.0013336726  0.0056494153 7.509061e-05 9.314396e-05 9.659432e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sd_x_smoothed sd_y_smoothed rho_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0.006015134   0.008572093    0.3493645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   0.006525224   0.009249017    0.4770515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   0.006980866   0.009583300    0.5965016</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   0.007387678   0.009651576    0.7222712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   0.007748769   0.009495122    0.8653833</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   0.008562239   0.007824836    1.5542048</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Predicting the correlation and its component at a specific time point</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">)</span>, <span class="fu">calc_rho</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>     t.for.pred <span class="op">=</span> <span class="va">DateID</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            x           y           x2           y2            xy          t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.00436128 -0.01009636 1.902076e-05 0.0001019365 -4.403306e-05 2000-04-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    x_smoothed   y_smoothed  x2_smoothed  y2_smoothed  xy_smoothed sd_x_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.001341848 -0.003946241 3.798239e-05 8.905361e-05 1.271878e-05   0.006015134</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sd_y_smoothed rho_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0.008572093    0.3493645</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The function can handle non consecutive time points</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">calc_rho</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">26</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>, h <span class="op">=</span> <span class="fl">3</span>, kernel <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             x           y         x2           y2           xy  t x_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  -0.6264538  1.51178117 0.39244438 2.2854823013 -0.947061074  1 -0.2214052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   0.1836433  0.38984324 0.03372487 0.1519777490  0.071592108  2 -0.4261464</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  -0.8356286 -0.62124058 0.69827518 0.3859398589  0.519126404  3  0.3144318</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   1.5952808 -2.21469989 2.54492084 4.9048955903 -3.533068213  4  0.3630533</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   0.3295078  1.12493092 0.10857537 1.2654695706  0.370673480  5  0.9623943</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  -0.8204684 -0.04493361 0.67316837 0.0020190292  0.036866606 26 -0.1665197</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   0.4874291 -0.01619026 0.23758708 0.0002621246 -0.007891605 27  0.1350951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   0.7383247  0.94383621 0.54512337 0.8908267926  0.696857592 28  0.6005117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   0.5757814  0.82122120 0.33152416 0.6744042513  0.472843850 29  0.3362392</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 -0.3053884  0.59390132 0.09326207 0.3527187793 -0.181370567 30  0.1351965</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     y_smoothed x2_smoothed y2_smoothed xy_smoothed sd_x_smoothed sd_y_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0.95081220   0.2130846 1.218730025  -0.4377345     0.4050486    0.56096897</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   0.42679461   0.3748148 0.941133303  -0.1187809     0.4395612    0.87119439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  -0.81536574   1.0923070 1.814271066  -0.9807832     0.9967144    1.07212395</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  -0.57033652   1.1172571 2.185435007  -0.8810894     0.9926980    1.36387362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  -0.54488448   1.3267481 3.085182580  -1.5811974     0.6328865    1.66981540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  -0.03056194   0.4553777 0.001140577   0.0144875     0.6539487    0.01437167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   0.29423745   0.4852929 0.297702649   0.2419442     0.6834049    0.45948555</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   0.58295571   0.3714115 0.521831056   0.3872699     0.1039097    0.42660719</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   0.78631958   0.3233032 0.639316608   0.3294436     0.4585263    0.14497632</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  0.70756126   0.2123931 0.513561515   0.1457366     0.4405849    0.11365994</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    rho_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    -1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     0.1647662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    -0.6779013</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    -0.4978356</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    -1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     0.6439003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     0.8391464</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     0.9785889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    1.0000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The function can handle non-ordered time series</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span>, <span class="fu">calc_rho</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              x            y           x2           y2            xy          t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.004361280 -0.010096362 1.902076e-05 1.019365e-04 -4.403306e-05 2000-04-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -0.004479051 -0.007449493 2.006189e-05 5.549494e-05  3.336666e-05 2000-04-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -0.007420214 -0.004377977 5.505958e-05 1.916668e-05  3.248553e-05 2000-04-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -0.007980069 -0.003332639 6.368150e-05 1.110648e-05  2.659469e-05 2000-04-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.008375645  0.011874107 7.015143e-05 1.409944e-04  9.945331e-05 2000-04-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  0.009697455  0.015107515 9.404064e-05 2.282370e-04  1.465045e-04 2000-04-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      x_smoothed    y_smoothed  x2_smoothed  y2_smoothed  xy_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.0013418481 -0.0039462414 3.798239e-05 8.905361e-05 1.271878e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  0.0004106755  0.0006175389 5.474643e-05 9.353427e-05 5.175352e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  0.0010704776 -0.0023441914 4.372446e-05 9.103955e-05 2.628156e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.0000271654  0.0019865563 6.004416e-05 9.410375e-05 6.372498e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 -0.0013336726  0.0056494153 7.509061e-05 9.314396e-05 9.659432e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  0.0007590436 -0.0008249469 4.930863e-05 9.252018e-05 3.927963e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sd_x_smoothed sd_y_smoothed rho_smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0.006015134   0.008572093    0.3493645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   0.007387678   0.009651576    0.7222712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   0.006525224   0.009249017    0.4770515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   0.007748769   0.009495122    0.8653833</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   0.008562239   0.007824836    1.5542048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   0.006980866   0.009583300    0.5965016</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Note: the function does not handle missing data (by design)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calc_rho(x = c(NA, rnorm(9)), y = rnorm(10), t = c(1:2, 23:30), h = 2) ## should err (if ran)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########################################################</span></span></span>
<span class="r-in"><span><span class="co">## Examples for the internal function computing the RMSE ##</span></span></span>
<span class="r-in"><span><span class="co">###########################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compute the RMSE on the correlation estimate</span></span></span>
<span class="r-in"><span><span class="co"># nb: takes a few seconds to run, so not run by default</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="in_pkgdown.html">in_pkgdown</a></span><span class="op">(</span><span class="op">)</span> <span class="op">||</span> <span class="cn">FALSE</span> <span class="co">## change to TRUE to run the example</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">small_clean_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">small_clean_dataset</span>, <span class="fu">calc_RMSE</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span>, h <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.541382</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">################################################################</span></span></span>
<span class="r-in"><span><span class="co">## Examples for the internal function selecting the bandwidth ##</span></span></span>
<span class="r-in"><span><span class="co">################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Automatic selection of the bandwidth using parallel processing</span></span></span>
<span class="r-in"><span><span class="co"># nb: takes a few seconds to run, so not run by default</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="in_pkgdown.html">in_pkgdown</a></span><span class="op">(</span><span class="op">)</span> <span class="op">||</span> <span class="cn">FALSE</span> <span class="co">## change to TRUE to run the example</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">small_clean_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">stockprice</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">small_clean_dataset</span>, <span class="fu">select_h</span><span class="op">(</span>x <span class="op">=</span> <span class="va">SP500</span>, y <span class="op">=</span> <span class="va">FTSE100</span>, t <span class="op">=</span> <span class="va">DateID</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> h selected using LOO-CV = 105.1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bandwidth automatic selection completed in 3.4 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $h</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 105.0813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $h_selection</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "LOO-CV"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $RMSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.234257</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.418 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Alexandre Courtiol, François Rousset.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

